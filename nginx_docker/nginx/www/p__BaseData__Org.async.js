(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{sudx:function(e,t,a){"use strict";a.r(t);a("rTtu");var n,s,i,r=a("jksg"),o=(a("Z3A/"),a("pB2J")),l=a("43Yg"),c=a.n(l),d=a("/tCh"),u=a.n(d),m=a("scpF"),h=a.n(m),p=a("O/V9"),f=a.n(p),y=a("8aBX"),g=a.n(y),v=a("uqIC"),b=a.n(v),S=a("7xWr"),w=a.n(S),k=a("Oia7"),C=a("sxfj"),A=a("zHco"),D=a("MMK4"),R=(a("wl+T"),a("zCXI")),N=(a("sjGl"),a("DAkq")),E=a("rXjv"),V=a.n(E),I=a("3CjV"),H=a.n(I),K=a("mK77"),L=a.n(K),j=a("LneV"),M=a("34ay"),O=(n=Object(j["connect"])(function(e){var t=e.userModel,a=e.uniComp,n=e.loading;return{userList:t.userList,uniComp:a,loading:n.models.userList}}),n((i=function(e){function t(){var e,a;c()(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return a=h()(this,(e=f()(t)).call.apply(e,[this].concat(s))),a.state={targetKeys:[],selectedKeys:[],oriSelectedArray:[],modalVisible:!1},a.componentDidMount=function(){var e=a.props,t=e.dispatch,n=e.modalVisible;a.setState({modalVisible:n});var s=Object(M["g"])();t({type:"userModel/allUserList",payload:{tableName:"sys_user",userId:s,data:{info:{pageNo:1,pageSize:9999}}}})},a.okHandle=function(){var e=a.state.targetKeys,t=a.props,n=t.dispatch,s=t.columnSchemas,i=s.key,r=s.relationKey,l=s.tableName,c=t.selectedRow,d=t.keyName,u=t.relationName,m=r||i,h=a.state.oriSelectedArray,p=[];h.forEach(function(t){var a=e.find(function(e){return e===t[d]});a?p.push(t):p.push(L()({},t,{act:"D"}))}),e.forEach(function(e){var t,a=h.find(function(t){return t[d]===e});a||p.push((t={},H()(t,m,c[i]),H()(t,"userId",e),H()(t,"act","A"),H()(t,"orgId",c[i]),t))});var f={option:8,tableName:l,data:{info:L()({},c,H()({},u,p))}};n({type:"uniComp/save",payload:f,callback:function(e){if("200"===e.code){var t=e.msg||"success.",n=a.props,s=n.onVisible,i=n.onRefreshData;s(!1),i(),o["a"].success(t)}else{var r=e.msg||"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef\u3002";o["a"].error(r)}}})},a.cancelHandle=function(){var e=a.props.onVisible;e(!1)},a.handleChange=function(e){a.setState({targetKeys:e})},a.handleSelectChange=function(e,t){a.setState({selectedKeys:[].concat(V()(e),V()(t))})},a.setKey=function(e){var t=a.props.keyName;return e[t]},a}return g()(t,e),u()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,a=t.modalVisible,n=t.selectedRow,s=e.modalVisible;if(s!==a&&this.setState({modalVisible:s}),s&&!a&&n){var i=this.props.relationName,r=n&&n[i]?n[i]:[],o=r.map(function(e){return e.userId});this.setState({targetKeys:o,oriSelectedArray:r})}}},{key:"render",value:function(){var e=this,t=this.props.userList,a=this.state,n=a.targetKeys,s=a.selectedKeys,i=a.modalVisible;return b.a.createElement(R["a"],{title:"\u6388\u6743",visible:i,onOk:function(){return e.okHandle()},onCancel:function(){return e.cancelHandle()}},b.a.createElement(N["a"],{showSearch:!0,rowKey:this.setKey,dataSource:t,titles:["\u672a\u9009\u62e9","\u5df2\u9009\u62e9"],targetKeys:n,selectedKeys:s,onChange:this.handleChange,onSelectChange:this.handleSelectChange,onScroll:this.handleScroll,render:function(e){return"".concat(e.userId,"-").concat(e.username)},listStyle:{width:200,height:300}}))}}]),t}(v["PureComponent"]),s=i))||s),P=O,q=a("HZnN"),U=q["a"].check,T=function(e){function t(){var e,a;c()(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return a=h()(this,(e=f()(t)).call.apply(e,[this].concat(s))),a.state={selectedRow:void 0,modalVisible:!1,columnSchemas:{}},a.handleUser=function(){var e=a.state.selectedRow;e&&"2"!==e.orgType?a.setState({modalVisible:!0}):o["a"].error("\u6d88\u8d39\u65b9\u65e0\u6cd5\u9009\u62e9\u7528\u6237\uff01")},a.handleList=function(){var e=a.state.selectedRow,t=e.id,n=e.orgCode;w.a.push({pathname:"/baseData/appkey",state:{id:t,orgCode:n}})},a.handleDown=function(){var e=a.state.selectedRow,t=e.id,n=Object(M["f"])(),s="/server/baseInfo/statement/org?orgId=".concat(t),i=new XMLHttpRequest;i.open("GET",s,!0),i.setRequestHeader("Content-type","application/json"),i.setRequestHeader("Authorization","Bearer ".concat(n)),i.send(),i.responseType="blob",i.onload=function(){var e=this.response,t=new FileReader;t.readAsDataURL(e),t.onload=function(e){var t=document.createElement("a");t.download="user_config.sql",t.href=e.target.result,document.body.appendChild(t),t.click()}}},a.handleVisible=function(e){a.setState({modalVisible:e})},a.handleRefreshData=function(){a.child.handleSearchDefault()},a.handleRef=function(e){a.child=e},a}return g()(t,e),u()(t,[{key:"componentWillMount",value:function(){var e=Object(M["a"])("org_save"),t=U(e,"Modify"),a=U(e,"role"),n=t||a?{title:"action",width:300,saveAct:t,commandAct:a,havePermissions:!0,haveAddPermissions:!0}:{havePermissions:!1,haveAddPermissions:!1},s=Object(D["d"])("common","status"),i={tableName:"org",key:"id",name:"orgName",reCallDetail:!0,columnDetails:[{name:"id",title:"ID",columnHidden:!1,add:!0,disabledAct:'trgit config --global user.name "tortoiseYY"ue'},{name:"orgCode",title:"Code",detailFlag:1},{name:"orgName",title:"Name",sorter:!0,query:!0,add:!0},{name:"createTime",title:"Create Date",format:"YYYY-MM-DD HH:mm:ss"},{name:"tel",title:"tel",columnHidden:!0,add:!0,rules:[]},{name:"email",title:"email",columnHidden:!0,add:!0,rules:[]},{name:"status",title:"Status",columnHidden:!1,query:!1,add:!0,tag:"commonSelect",tableName:"org",enumData:s,addHidden:!0,rules:[]},{name:"remark",title:"remark",tag:"textArea",columnHidden:!0,add:!0,rows:3,rules:[]}],relations:[{name:"sysUsers",key:"id",title:"Access User List",columnDetails:[{name:"id",title:"User Id"},{name:"username",title:"User Name"},{name:"password",title:"Pass Word"},{name:"utype",title:"Account Type"},{name:"status",title:"Status"},{name:"tokenExpireTime",title:"Expire Time (Minute)"}]},{name:"consumerApis",key:"apiId",title:"Consumer Api List",columnDetails:[{name:"apiId",title:"Api Id"},{name:"name",title:"Name"},{name:"requestUrl",title:"Path"},{name:"statusName",title:"Status"}]},{name:"producerApis",key:"apiId",title:"Producer Api List",columnDetails:[{name:"apiId",title:"Api Id"},{name:"name",title:"Name"},{name:"requestUrl",title:"Path"},{name:"statusName",title:"Status"}]}],actions:n},r=Object(M["h"])(),o=Object(M["g"])();i.userName=r,i.userId=o,this.setState({columnSchemas:i})}},{key:"render",value:function(){var e=this,t=this.state,a=t.modalVisible,n=t.selectedRow,s=t.columnSchemas;return b.a.createElement(A["a"],null,b.a.createElement(k["a"],{columnSchemas:s,onRef:this.handleRef,size:"middle",onRow:function(t){return{onMouseEnter:function(){e.setState({selectedRow:t})}}}},b.a.createElement("span",{id:"QueryCommand"},b.a.createElement(C["a"],null,b.a.createElement(r["a"],{type:"vertical"}),b.a.createElement("a",{onClick:function(){return e.handleUser()},title:"Set Data Access Permission"},"Access"),b.a.createElement(r["a"],{type:"vertical"}),b.a.createElement("a",{onClick:function(){return e.handleList()},title:"Appkey List"},"Appkey"),b.a.createElement(r["a"],{type:"vertical"}),b.a.createElement("a",{onClick:function(){return e.handleDown()},title:"Download Org Config Sql"},"Download")))),b.a.createElement(P,{title:"\u6388\u6743",modalVisible:a,onVisible:this.handleVisible,columnSchemas:s,selectedRow:n,onRefreshData:this.handleRefreshData,keyName:"userId",relationName:"sysUserOrgs"}))}}]),t}(v["PureComponent"]);t["default"]=T}}]);