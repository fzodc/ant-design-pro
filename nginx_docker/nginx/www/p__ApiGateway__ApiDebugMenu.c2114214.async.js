(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{UwZ8:function(e,t,a){"use strict";a.r(t);a("j+Ep");var n,r,s,o,l=a("/Dxd"),i=(a("ssvk"),a("Qo4C")),c=(a("cZcT"),a("T+5x")),u=(a("4WAF"),a("Qfhr")),p=a("zAuD"),d=a.n(p),m=(a("KbV2"),a("I+kI")),g=(a("wl+T"),a("zCXI")),y=(a("Z3A/"),a("pB2J")),f=(a("mofY"),a("HZOl")),h=(a("85xf"),a("IYgN")),v=a("mK77"),S=a.n(v),b=a("43Yg"),E=a.n(b),I=a("/tCh"),k=a.n(I),w=a("scpF"),D=a.n(w),C=a("O/V9"),T=a.n(C),B=a("8aBX"),q=a.n(B),x=(a("YyIT"),a("2pDd")),N=(a("PCp+"),a("HnZV")),O=(a("GCRk"),a("fmtF")),A=(a("RmDK"),a("/6XP")),R=a("uqIC"),K=a.n(R),F=a("LneV"),M=a("p0YK"),L=a.n(M),V=a("XFA+"),z=a("0EJC"),H=a("gcl2"),J=a.n(H),j=a("nPZ7"),P=a("MMK4"),_=a("34ay"),Y=A["a"].Option,W=O["a"].TabPane,Z=N["a"].TextArea,X="requestHeader",U="requestBody",G="responseHeader",Q="responseBody",$={requestBodySample:"request Body Sample",responseBodySample:"response Body Sample"},ee=Object(V["a"])({}),te=(n=Object(F["connect"])(function(e){var t=e.uniComp,a=e.loading;return{uniComp:t,loading:a.models.uniComp}}),r=x["a"].create({}),n(s=r((o=function(e){function t(){var e,a;E()(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return a=D()(this,(e=T()(t)).call.apply(e,[this].concat(r))),a.state={responseBodySampleJson:[],responseBodySampleStr:"",width:"100%",responseCode:{status:null,statusText:null,respTime:0,respSize:0}},a.getOption=function(e,t,a,n){return!e||e.length<1?K.a.createElement(Y,{key:0,value:0},"\u6ca1\u6709\u627e\u5230\u9009\u9879"):e.map(function(e){return K.a.createElement(Y,{key:e[t],value:e[t],ss:e[n]},e[a],"-",e[t])})},a.convertDocObj=function(e,t){try{if(e){var a=e["".concat(t,"Sample")];if(a&&""!==a.trim()){var n=(JSON.parse(a)||[]).map(function(e,t){return S()({},e,{key:"".concat(X,"-").concat(t)})});return n}}}catch(e){console.log(e)}return[]},a.getToken=function(e,t){if(0!==e){var n=a.props.form;if("0"===t.props.ss){var r=e,s=Object(P["b"])("serviceAgent","req_header","tokenKey"),o=n.getFieldValue("requestHeaderSample");n.setFieldsValue({requestHeaderSample:{}}),o=o.filter(function(e){return e.name!==s});var l=[{key:"Content-Type",name:"Content-Type",remark:"application/json"}];o.forEach(function(e){"AppKey"!==e.name?"Content-Type"!==e.name&&l.push(e):(e.remark=r,l.push(e))});var i=l.filter(function(e){return"AppKey"===e.name});i&&0!==i.length||l.push({key:"AppKey",name:"AppKey",remark:r}),n.setFieldsValue({requestHeaderSample:l})}else{var c=a.props.dispatch,u={};u.appkey=e,c({type:"uniComp/token",payload:u,callback:function(t){console.log("resp=======",t);var a=t.data;if("200"===t.code){var r=e,s=Object(P["b"])("serviceAgent","req_header","tokenKey"),o=a.token,l=n.getFieldValue("requestHeaderSample"),i=[{key:"Content-Type",name:"Content-Type",remark:"application/json"}];l.forEach(function(e){"AppKey"!==e.name?e.name===s?(e.remark=o,i.push(e)):"Content-Type"!==e.name&&i.push(e):(e.remark=r,i.push(e))});var c=i.filter(function(e){return"AppKey"===e.name}),u=i.filter(function(e){return e.name===s});c&&0!==c.length||i.push({key:"AppKey",name:"AppKey",remark:r}),u&&0!==u.length||i.push({key:s,name:s,remark:o}),n.setFieldsValue({requestHeaderSample:i})}}})}}},a.resizeFooterToolbar=function(){requestAnimationFrame(function(){var e=document.querySelectorAll(".ant-layout-sider")[0];if(e){var t="calc(100% - ".concat(e.style.width,")"),n=a.state.width;n!==t&&a.setState({width:t})}})},a.getErrorInfo=function(){var e=a.props.form.getFieldsError,t=e(),n=Object.keys(t).filter(function(e){return t[e]}).length;if(!t||0===n)return null;var r=function(e){var t=document.querySelector('label[for="'.concat(e,'"]'));t&&t.scrollIntoView(!0)},s=Object.keys(t).map(function(e){return t[e]?K.a.createElement("li",{key:e,className:J.a.errorListItem,onClick:function(){return r(e)}},K.a.createElement(h["a"],{type:"cross-circle-o",className:J.a.errorIcon}),K.a.createElement("div",{className:J.a.errorMessage},t[e][0]),K.a.createElement("div",{className:J.a.errorField},$[e])):null});return K.a.createElement("span",{className:J.a.errorIcon},K.a.createElement(f["a"],{title:"\u8868\u5355\u6821\u9a8c\u4fe1\u606f",content:s,overlayClassName:J.a.errorPopover,trigger:"click",getPopupContainer:function(e){return e.parentNode}},K.a.createElement(h["a"],{type:"exclamation-circle"})),n)},a.strToSize=function(e){for(var t=0,a=0;a<e.length;){var n=e.charAt(a);n.codePointAt(0)>65535?t+=4:t+=2,a+=1}var r=(t/1024).toFixed(2);return r},a.send=function(){var e=a.props,t=e.form,n=e.apiService,r=t.getFieldsValue();t.validateFields(["urlSample"],{},function(e,s){if(e)console.log("form",e,s);else{var o=Object(_["c"])(),l=Object(j["h"])(o,r),i=n&&n.reqMethod?n.reqMethod:"get",c=(new Date).getMilliseconds();ee(l.urlSample,{method:i,data:l.requestBodySample,getResponse:!0,headers:l.requestHeaderSample}).then(function(e){var n=e.data,r=e.response;console.log("success",n,r);var s=(new Date).getMilliseconds(),o=JSON.stringify(n).substr(0,5e3),l=JSON.stringify(n)+JSON.stringify(r),i=a.strToSize(l);t.setFieldsValue({responseBodySample:o,responseHeaderSample:JSON.stringify(r.headers)}),a.setState({responseBodySampleJson:n,responseBodySampleStr:JSON.stringify(n)});var u=Math.abs(s-c),p={};p.status=r.status,p.statusText=r.statusText,p.respTime=u,p.respSize=i,a.setState({responseCode:p}),200===r.status?y["a"].success("Send Success"):y["a"].error("Send Fail")}).catch(function(e){console.log("err:",e);var n=(new Date).getMilliseconds(),r=Math.abs(n-c),s="500",o=e,l={};e.response&&(console.log("err",e.response),s=e.response.status,o=e.response.statusText,t.setFieldsValue({responseHeaderSample:JSON.stringify(e.response.headers),responseBodySample:JSON.stringify(e.data)}),a.setState({responseBodySampleJson:e.data,responseBodySampleStr:JSON.stringify(e.data)}));var i=JSON.stringify(e.response),u=a.strToSize(i);l.status=s,l.statusText=o,l.respTime=r,l.respSize=u,a.setState({responseCode:l}),y["a"].error("Send Fail")})}})},a.save=function(){a.getErrorInfo();var e=a.props,t=e.form.validateFieldsAndScroll,n=e.apiService,r=e.dispatch,s=Object(_["g"])();n.userId=s,t(function(e,t){if(!e){var s=Object(j["e"])(n,t);console.log("api doc update submit apiInfo:",s),r({type:"uniComp/saveDebug",payload:s,callback:function(e){"200"===e.code?(y["a"].success("\u63d0\u4ea4\u6210\u529f"),1===s.option?a.getDebugList("save",""):a.getDebugList("update",t.userDebugId)):y["a"].error("\u63d0\u4ea4\u5931\u8d25")}})}})},a.getDebugList=function(e,t){var n=a.props,r=n.apiId,s=n.dispatch,o=n.onApiDebug,l=Object(_["g"])(),i="api_user_debug",c=9999,u={userId:l,tableName:i,pageSize:c,apiId:r};console.log("binddata",u),s({type:"uniComp/list",payload:u,onConversionData:void 0,callback:function(a){var n=a.data,r=n.records,s=r.map(function(e){return S()({},e,{userDebugId:"u".concat(e.userDebugId)})}),l=s&&s.length>0?s[s.length-1].userDebugId:null,i=s&&s.length>0?s[s.length-1]:null,c=0,u={},p=t;"del"===e&&(c=t),"update"===e&&(c=t,u=s.filter(function(e){return t&&e.userDebugId===t})[0],p=""),"save"===e&&(c=l,u=i,p=""),console.log("---getDebugList----",e,t,u),o(s,c,u,p)}})},a.deleteItem=function(e){console.log("handleDel",e);var t=a.props.dispatch,n={tableName:"api_user_debug"};n.id=e.replace("u",""),t({type:"uniComp/del",payload:n,callback:function(t){console.log("resp=======",t),"200"===t.code?(y["a"].success("\u5220\u9664\u6210\u529f"),a.getDebugList("del",e)):y["a"].error("\u5220\u9664\u5931\u8d25")}})},a.handleDel=function(e){g["a"].confirm({title:"Delete Api Debug",content:"Are you sure delete this Api Debug\uff1f",okText:"Yes",cancelText:"No",onOk:function(){return a.deleteItem(e)}})},a}return q()(t,e),k()(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resizeFooterToolbar,{passive:!0});var e=this.props.onRef;e(this)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,a=t.selectedRow,n=t.form;if(console.log("componentWillReceiveProps",e.selectedRow),e.selectedRow&&a!==e.selectedRow){console.log("change111111");var r=e.selectedRow,s=this.convertDocObj(r,X),o=r.requestBodySample,l=r.responseBodySample,i=r.userDebugId,c=r.debugName,u=r.urlSample,p=r.responseHeaderSample;n.setFieldsValue({userDebugId:i,debugName:c,urlSample:u,requestHeaderSample:s,requestBodySample:o,responseHeaderSample:p,responseBodySample:l});var d=""===l?[]:l;this.setState({responseBodySampleJson:d,responseBodySampleStr:l})}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeFooterToolbar)}},{key:"getOrgOption",value:function(){var e=this.props.apiService,t=e||{apiServiceOrgs:null},a=t.apiServiceOrgs;return this.getOption(a,"appkey","orgName","authType")}},{key:"render",value:function(){var e=this,t=this.props,a=t.form,n=t.submitting,r=t.apiService,s=t.selectedRow,o=a.getFieldDecorator,p=s.userDebugId,g=s.debugName,y=s.urlSample,h=s.requestBodySample,v=s.responseHeaderSample,S=s.responseBodySample,b=this.state,E=b.responseCode,I=b.responseBodySampleJson,k=b.responseBodySampleStr,w=this.convertDocObj(s,X);console.log("render---123---",this.state);var D='sample for post:{"type":"xxx","name":"xxx"}',C=K.a.createElement(m["a"],{type:"danger",shape:"circle",icon:"delete",onClick:function(){return e.handleDel(p)}});s.isNew&&(C="");var T="",B=!!k&&k.startsWith("{");if(console.log("render",k,B),null!==E.status){var q=K.a.createElement("div",null,K.a.createElement("p",null,E.statusText));T=K.a.createElement("div",null,K.a.createElement(f["a"],{content:q,title:E.status},"Status\uff1a",K.a.createElement("span",{style:{color:200!==E.status?"red":""}},E.status)),K.a.createElement("span",null,"\xa0Time\uff1a",E.respTime,"ms "),K.a.createElement("span",null,"Size: ",E.respSize,"KB"))}var R={labelCol:{span:8},wrapperCol:{span:16}};return K.a.createElement("div",null,K.a.createElement(i["a"],{title:"",className:J.a.card,bordered:!1},K.a.createElement(c["a"],null,K.a.createElement(u["a"],{xl:{span:8},style:{height:60}},K.a.createElement(x["a"].Item,d()({label:"Debug Name"},R),o("debugName",{initialValue:g,rules:[{required:!0,message:"debugName must be between 2 and 80 characters\uff01",min:2,max:80}]})(K.a.createElement(N["a"],{placeholder:"please enter request debugName"})))),K.a.createElement(u["a"],{xl:{span:16},style:{textAlign:"left"}},C)),K.a.createElement(c["a"],null,K.a.createElement(u["a"],{xl:{span:5},lg:{span:3},md:{span:6},sm:24,style:{height:50}},K.a.createElement(x["a"].Item,null,o("orgId")(K.a.createElement(A["a"],{placeholder:"please choose",style:{width:"100%"},onChange:this.getToken},this.getOrgOption())),o("userDebugId",{initialValue:p})(K.a.createElement(N["a"],{hidden:!0})))),K.a.createElement(u["a"],{xl:{span:3},lg:{span:3},md:{span:6},sm:24,style:{height:50}},K.a.createElement(x["a"].Item,null,o("reqMethod",{initialValue:r&&r.reqMethod?r.reqMethod:null,rules:[]})(K.a.createElement(N["a"],{placeholder:"request Method",disabled:!0})))),K.a.createElement(u["a"],{lg:9,md:6,sm:24,style:{height:50}},K.a.createElement(x["a"].Item,null,o("urlSample",{initialValue:y,rules:[{required:!0,message:"urlSample must be between 2 and 500 characters\uff01",min:2,max:500}]})(K.a.createElement(N["a"],{placeholder:"request Url"})))),K.a.createElement(u["a"],{xl:{span:6},lg:9,md:6,sm:24,style:{height:40}},K.a.createElement(x["a"].Item,null,K.a.createElement(m["a"],{type:"primary",onClick:this.send},"Send"),K.a.createElement("span",null,"\xa0\xa0"),K.a.createElement(m["a"],{type:"danger",onClick:this.save,loading:n},"Save")))),K.a.createElement(c["a"],null,K.a.createElement(O["a"],{defaultActiveKey:"1",tabBarExtraContent:T},K.a.createElement(W,{tab:"Request Header",key:"1"},K.a.createElement(x["a"].Item,null,K.a.createElement(i["a"],{title:"",className:J.a.card,bordered:!1},o("requestHeaderSample",{initialValue:w})(K.a.createElement(z["a"],{hideParent:!0,hideType:!0,nameTitle:"Key",remarkTitle:"value",disableEdit:"1"}))))),K.a.createElement(W,{tab:"Request Body",key:"2"},K.a.createElement(x["a"].Item,null,o("".concat(U,"Sample"),{initialValue:h,rules:[{required:!1,message:"\u4e0d\u80fd\u8d85\u8fc75000\u5b57\u7b26\uff01",max:5e3}]})(K.a.createElement(Z,{placeholder:D,autosize:{minRows:4,maxRows:15}})))))),K.a.createElement(c["a"],null,K.a.createElement(O["a"],{defaultActiveKey:"4"},K.a.createElement(W,{tab:"Response Header",key:"3"},o("".concat(G,"Sample"),{initialValue:v,rules:[{required:!1,message:"\u4e0d\u80fd\u8d85\u8fc75000\u5b57\u7b26\uff01",max:5e3}]})(K.a.createElement(Z,{placeholder:"",autosize:{minRows:4,maxRows:15}}))),K.a.createElement(W,{tab:"Response Body",key:"4"},K.a.createElement(x["a"].Item,null,o("".concat(Q,"Sample"),{initialValue:S,rules:[]})(K.a.createElement(Z,{rows:4,placeholder:"",autosize:{minRows:4,maxRows:15},hidden:!0}))),K.a.createElement(x["a"].Item,{style:{display:B?"none":""}},o("responseBodySampleStr",{initialValue:k,rules:[]})(K.a.createElement(Z,{rows:4,placeholder:"",autosize:{minRows:4,maxRows:15}}))),K.a.createElement(L.a,{src:I,name:"response body sample",collapsed:!1,iconStyle:"circle",style:{display:B?"":"none"}}))))),K.a.createElement(l["a"],null))}}]),t}(R["PureComponent"]),s=o))||s)||s);t["default"]=te},YshT:function(e,t,a){"use strict";a.r(t);var n,r,s,o=a("mK77"),l=a.n(o),i=(a("wl+T"),a("zCXI")),c=(a("Z3A/"),a("pB2J")),u=a("43Yg"),p=a.n(u),d=a("/tCh"),m=a.n(d),g=a("scpF"),y=a.n(g),f=a("O/V9"),h=a.n(f),v=a("8aBX"),S=a.n(v),b=(a("GCRk"),a("fmtF")),E=a("uqIC"),I=a.n(E),k=a("LneV"),w=a("7xWr"),D=a.n(w),C=a("34ay"),T=a("zHco"),B=a("UwZ8"),q=b["a"].TabPane,x=(n=Object(k["connect"])(function(e){var t=e.uniComp,a=e.loading;return{uniComp:t,loading:a.models.uniComp}}),n((s=function(e){function t(){var e,a;p()(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return a=y()(this,(e=h()(t)).call.apply(e,[this].concat(r))),a.state={selectKey:null,selectedRow:{},apiService:{},menuList:[],newItem:!1},a.getApi=function(e){var t=a.props.dispatch;if(-1!==e){var n={option:4,range:1,data:{}};n.data.info={},n.data.info.apiId=e,t({type:"apiCreateModel/apiInfo",payload:n,callback:function(e){a.setBaseInfo(e,t)}})}else D.a.push("/exception/403")},a.addTag=function(e,t,n){if(1===n||0===e.length){var r=t||{},s=r.apiServiceDoc,o=r.tenantId,l=t?"/".concat(o).concat(t.requestUrl):"",i="u0",c={debugName:"",requestBodySample:s?s.requestBodySample:"",urlSample:l,responseHeaderSample:"",responseBodySample:"",userDebugId:i,isNew:!0};e.push(c),a.setState({menuList:e,newItem:!0,selectKey:i,selectedRow:c})}},a.setBaseInfo=function(e){var t=e.data,n=a.state.menuList;console.log("setBaseInfo",t),a.setState({apiService:t}),a.addTag(n,t,0)},a.onChange=function(e){console.log("onChange",e);var t=a.state.menuList,n=t.filter(function(t){return e&&t.userDebugId===e}),r=n[0];a.setState({selectKey:e,selectedRow:r})},a.onEdit=function(e,t){a[t](e)},a.add=function(){var e=a.state,t=e.menuList,n=e.newItem,r=e.apiService;n?c["a"].error("Now,you have a new item.Please first save,then new item."):a.addTag(t,r,1)},a.resetMenuList=function(e){var t=0,n=a.state,r=n.menuList,s=n.selectKey,o=n.apiService,l=e;console.log("resetMenuList",l,r),r.forEach(function(e,a){e.userDebugId===l&&(t=a-1)});var i=r.filter(function(e){return l&&e.userDebugId!==l}),c={},u=s;console.log("ddddd-----",t,i),i.length>0&&s===l&&(s>=0?(u=i[t].userDebugId,c=i[t]):(u=i[0].userDebugId,c=i[0])),a.setState({menuList:i,selectKey:u,selectedRow:c}),a.addTag(i,o,0)},a.deleteTab=function(e){var t=a.props.dispatch,n={tableName:"api_user_debug"};n.id=e.replace("u",""),t({type:"uniComp/del",payload:n,callback:function(t){"200"===t.code?(c["a"].success("\u5220\u9664\u6210\u529f"),a.resetMenuList(e)):c["a"].error("\u5220\u9664\u5931\u8d25")}})},a.remove=function(e){i["a"].confirm({title:"Delete Api Debug",content:"Are you sure delete this Api Debug\uff1f",okText:"Yes",cancelText:"No",onOk:function(){return a.deleteTab(e)}})},a.getTabs=function(){var e=a.state,t=e.menuList,n=e.apiService,r=e.selectedRow,s=a.props.location,o=s.state,l=o||{apiId:105},i=l.apiId;return console.log("getMenu",t),t.map(function(e){return I.a.createElement(q,{key:e.userDebugId,tab:e.debugName,closable:!e.isNew},I.a.createElement(B["default"],{apiId:i,selectedRow:r,apiService:n,onRef:a.onRef,onApiDebug:a.handelMenu}))})},a.onRef=function(e){a.child=e},a.handelMenu=function(e,t,n,r){console.log("---handelMenu\uff1d\uff1d\uff1d\uff1d3:",e),e?""!==r?(console.log(t),a.resetMenuList(t)):a.setState({menuList:e,selectKey:t,newItem:!1,selectedRow:n}):a.setState({menuList:null,selectKey:null,newItem:!1,selectedRow:null})},a}return S()(t,e),m()(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.location,n=t.dispatch,r=a.state,s=r||{apiId:105},o=s.apiId,i=Object(C["g"])(),c="api_user_debug",u=9999,p={userId:i,tableName:c,pageSize:u,apiId:o};console.log("binddata",p),n({type:"uniComp/list",payload:p,onConversionData:void 0,callback:function(t){console.log("---123---",t);var a=t.data,n=a.records,r=n.map(function(e){return l()({},e,{userDebugId:"u".concat(e.userDebugId)})}),s=r&&r.length>0?r[0].userDebugId:null;console.log("----22222---",s),e.setState({selectKey:s,selectedRow:r[0],menuList:r})}}),this.getApi(o)}},{key:"render",value:function(){var e=this.state.selectKey;return I.a.createElement(T["a"],{onBack:function(){return window.history.back()},style:{height:"50px"},title:"Api Debug"},I.a.createElement(b["a"],{tabPosition:"left",defaultActiveKey:e,onChange:this.onChange,activeKey:e,type:"editable-card",onEdit:this.onEdit},this.getTabs()))}}]),t}(E["Component"]),r=s))||r);t["default"]=x}}]);