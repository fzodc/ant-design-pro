(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{Y4ob:function(e,t,a){"use strict";a.r(t);a("B3Wq");var n,r,l,i,o,s,d=a("CImR"),c=a("zAuD"),u=a.n(c),p=(a("GWAV"),a("7YyU")),m=(a("ssvk"),a("Qo4C")),h=(a("cZcT"),a("T+5x")),y=(a("4WAF"),a("Qfhr")),f=(a("KbV2"),a("I+kI")),g=(a("/AXM"),a("MaTn")),b=(a("rTtu"),a("jksg")),k=(a("YVuj"),a("KfNe")),v=(a("85xf"),a("IYgN")),E=(a("kQuL"),a("Ig54")),C=(a("Z3A/"),a("pB2J")),S=a("43Yg"),w=a.n(S),V=a("/tCh"),A=a.n(V),I=a("scpF"),D=a.n(I),T=a("O/V9"),x=a.n(T),O=a("8aBX"),M=a.n(O),N=a("mK77"),R=a.n(N),K=(a("PCp+"),a("HnZV")),j=(a("wl+T"),a("zCXI")),z=(a("RmDK"),a("/6XP")),P=(a("YyIT"),a("2pDd")),H=a("uqIC"),F=a.n(H),q=a("LneV"),Y=a("zHco"),B=a("xNuS"),X=a("MMK4"),U=a("34ay"),W=a("kmo5"),_={appKey:"AppKey\uff1a",authorizedApi:"Authorized Api",unathorizedApi:"Unauthorized Api"},J=function(e){function t(){return w()(this,t),D()(this,x()(t).apply(this,arguments))}return M()(t,e),A()(t,[{key:"render",value:function(){var e=this.props,t=e.selectedRow,a=e.targetServices,n=t||{appkey:"",callerName:"",targetSystemName:"",apiServices:[]},r=n.appkey,l=n.callerName,i=n.apiServices,o=n.targetSystemName,s=l||o;console.log(r,s);var d="apiId",c=[],u=i||[];a&&a.forEach(function(e){var t=u.find(function(t){return t[d]===e[d]});t||c.push(e)});var f=[{title:"Api Id",dataIndex:"apiId"},{title:"Api Name",dataIndex:"name"},{title:"Request Url",dataIndex:"requestUrl",render:function(e){return F.a.createElement(B["a"],{length:20,tooltip:!0},e)}}],g={pageSize:5};return F.a.createElement(h["a"],{gutter:16},F.a.createElement(y["a"],{span:12},F.a.createElement(m["a"],{title:_.authorizedApi,bordered:!1},F.a.createElement(p["a"],{size:"small",columns:f,dataSource:i,pagination:g}))),F.a.createElement(y["a"],{span:12,style:{display:o?"none":""}},F.a.createElement(m["a"],{title:_.unathorizedApi,bordered:!1},F.a.createElement(p["a"],{size:"small",columns:f,dataSource:c,pagination:g}))))}}]),t}(H["PureComponent"]),Q=J,Z=(a("sjGl"),a("DAkq")),G=a("rXjv"),L=a.n(G),$=a("3CjV"),ee=a.n($),te=(n=Object(q["connect"])(function(e){var t=e.appkeyModel,a=e.loading;return{appkeyModel:t,loading:a.models.appkeyModel}}),n((l=function(e){function t(){var e,a;w()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return a=D()(this,(e=x()(t)).call.apply(e,[this].concat(r))),a.state={targetKeys:[],selectedKeys:[],modalVisible:!1,oriSelectedArray:[]},a.componentDidMount=function(){var e=a.props.modalVisible;a.setState({modalVisible:e})},a.okHandle=function(){var e,t=a.props,n=t.dispatch,r=t.selectedRow,l=t.keyName,i="apiIds",o="appkey",s=a.state,d=s.oriSelectedArray,c=s.targetKeys,u=[];d.forEach(function(e){var t=c.find(function(t){return t===e[l]});t&&u.push(e.apiId)}),c.forEach(function(e){var t=d.find(function(t){return t[l]===e});t||u.push(e)});var p={data:{info:(e={},ee()(e,o,r[o]),ee()(e,i,u),e)}};n({type:"appkeyModel/access",payload:p,callback:function(e){if("200"===e.code){var t=e.msg||"success.",n=a.props,r=n.onVisible,l=n.onRefreshData;r(!1),l(),C["a"].success(t)}else{var i=e.msg||"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef\u3002";C["a"].error(i)}}})},a.cancelHandle=function(){var e=a.props.onVisible;e(!1)},a.handleChange=function(e){a.setState({targetKeys:e})},a.handleSelectChange=function(e,t){a.setState({selectedKeys:[].concat(L()(e),L()(t))})},a.setKey=function(e){var t=a.props.keyName;return e[t]},a}return M()(t,e),A()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,a=t.modalVisible,n=(t.selectedRow,e.modalVisible),r=e.selectedRow;if(n!==a&&this.setState({modalVisible:n}),n&&!a&&r){var l=this.props.relationName,i=r&&r[l]?r[l]:[],o=i.map(function(e){return e.apiId});this.setState({targetKeys:o,oriSelectedArray:i})}}},{key:"render",value:function(){var e=this,t=this.props.apiServices,a=this.state,n=a.targetKeys,r=a.selectedKeys,l=a.modalVisible;return F.a.createElement(j["a"],{title:"\u6388\u6743",visible:l,onOk:function(){return e.okHandle()},onCancel:function(){return e.cancelHandle()}},F.a.createElement(Z["a"],{showSearch:!0,rowKey:this.setKey,dataSource:t,titles:["\u672a\u9009\u62e9","\u5df2\u9009\u62e9"],targetKeys:n,selectedKeys:r,onChange:this.handleChange,onSelectChange:this.handleSelectChange,onScroll:this.handleScroll,render:function(e){return"".concat(e.apiId,"-").concat(e.name)},listStyle:{width:200,height:300}}))}}]),t}(H["PureComponent"]),r=l))||r),ae=te,ne=P["a"].Item,re=z["a"].Option,le=Object(X["d"])("common","status"),ie=Object(X["d"])("appkey","auth_type"),oe=Object(X["e"])("appkey","token_expire");console.log("tokenE",oe);var se=Object(X["d"])("appkey","range"),de=se.map(function(e){return{value:e.itemCode,text:e.itemValue}}),ce=function(e,t){var a=e.columnSchemas.columnDetails;return a.filter(function(e){return e[t]})},ue=P["a"].create()(function(e){var t=e.selectedRow,a=e.modalVisible,n=e.form,r=e.handleAdd,l=e.handleModalVisible,i=e.authType,o=e.authChange,s=e.columnSchemas.key,d=t?"Are you sure modify, it maybe effect use this appkey call user":"Do you submit\uff1f",c=function(){n.validateFields(function(e,t){e||j["a"].confirm({title:"",content:d,okText:"Confirm",cancelText:"Cancel",onOk:function(){return r(t,n)}})})},u=function(e,t){n.resetFields(),l(e,t)},p=function(e){switch(e.tag){case"commonSelect":return F.a.createElement(z["a"],{style:{width:"100%"},disabled:e.disabled,onChange:o},e.enumData.map(function(t){return F.a.createElement(re,{key:"".concat(e.javaCode,"_").concat(e.javaKey,"_").concat(t.itemCode),value:t.itemCode},t.itemValue)}));default:return F.a.createElement(K["a"],{disabled:e.disabled,placeholder:"please enter ".concat(e.title)})}},m=ce(e,"add").filter(function(e){return!("".concat(e.name)===s&&!t)}).map(function(e){var t=e;return t.disabled=t.name===s||"true"===t.disabledAct,t}),h=ce(e,"edit").filter(function(e){return!("".concat(e.name)===s&&!t)}).map(function(e){var t=e;return t.disabled="true"===t.disabledAct,t}),y=t?"update":"new";t&&(m=h);var f="";if(t){var g=t||{authType:""},b=g.authType;b&&(f=b)}return i&&(f=i),console.log("newAuthType",f),F.a.createElement(j["a"],{title:y,visible:a,onOk:c,onCancel:function(){return u()}},F.a.createElement("div",null,m.map(function(e){var a={};return"0"!==f&&"2"!==f||"tokenExpireTime"!==e.name||(a={display:"none"}),"2"===f&&"tokenExpireTime"===e.name&&(a={display:"none"}),"2"===f&&"tokenExpire"===e.name?a={display:"block"}:"tokenExpire"===e.name&&(a={display:"none"}),F.a.createElement(ne,{style:R()({},a),key:"addFormItem-".concat(e.name),labelCol:{span:8},wrapperCol:{span:12},label:e.title},n.getFieldDecorator(e.name,{initialValue:t?e.prefix&&t[e.name]?t[e.name].replace(e.prefix,""):t[e.name]:e.defaultValue||"",rules:e.rules?[]:[{required:!0,message:"please enter ".concat(e.title)}]})(p(e)))})))}),pe=(i=Object(q["connect"])(function(e){var t=e.uniComp,a=e.appkeyModel,n=e.loading;return{uniComp:t,appkeyModel:a,loading:n.models.uniComp}}),i((s=function(e){function t(){var e,a;w()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return a=D()(this,(e=x()(t)).call.apply(e,[this].concat(r))),a.state={apiServices:[],appkeyInbounds:[],appkeyOutbounds:[],modalVisible:!1,selectedRow:{},sign:0,orgId:"",orgCode:"",drawerVisible:!1,transferVisible:!1,authType:""},a.getOrgInfo=function(e){e&&e.preventDefault&&e.preventDefault(),a.getOrgDetail(e)},a.getOrgDetail=function(e){var t=a.props.dispatch;t({type:"uniComp/detail",payload:{tableName:"org",id:e},callback:function(t){var n=t.appkeyInbounds,r=t.appkeyOutbounds,l=t.orgCode,i=t.apiServices,o=n.map(function(e){var t=R()({},e,{tokenExpire:e.tokenExpireTime});return t});a.setState({orgId:e,orgCode:l,appkeyInbounds:o,appkeyOutbounds:r,apiServices:i})}})},a.respDeal=function(e){var t=a.state.orgId,n=e.code,r=e.msg;"200"===n?(r&&""!==r||(r="Success."),C["a"].success(r),a.getOrgDetail(t)):C["a"].error("error:".concat(r))},a.handleDel=function(e,t){var n=a.props.dispatch,r=a.state,l=r.sign,i=r.orgCode,o="appkeyInbound";1===l&&(o="appkeyOutbound");var s={tableName:o,data:{}};s.data.info={},s.option=parseInt(t,10),s.data.info.id=e.id,s.data.info.orgCode=i,n({type:"appkeyModel/save",payload:s,callback:function(e){a.respDeal(e)}})},a.handleModalVisible=function(e,t,n){var r=a.state.orgCode;""!==r?a.setState({modalVisible:t,selectedRow:e,sign:n,authType:null}):C["a"].error("Please select Org Name!")},a.handleDrawerVisible=function(e,t){a.setState({selectedRow:e,drawerVisible:!!t})},a.handleTransferVisible=function(e,t){a.setState({transferVisible:t,selectedRow:e})},a.handleAdd=function(e){var t=e,n=a.state,r=n.selectedRow,l=n.sign,i=n.orgCode,o="orgCode",s=a.props.dispatch,d="id",c=1,u=Object(U["h"])(),p=r?r[d]:"";""!==p&&(t[d]=p,c=2),t[o]=i;var m="appkeyInbound";1===l&&(m="appkeyOutbound");var h={tableName:m,option:c,userName:u,data:{info:t}};s({type:"appkeyModel/save",payload:h,callback:function(e){a.respDeal(e),a.handleModalVisible(r,!1,l)}})},a.onDrawerClose=function(){a.handleDrawerVisible(null,!1)},a.handleAccess=function(e,t){a.handleTransferVisible(t,e)},a.handleRefreshData=function(){var e=a.state.orgId;a.getOrgDetail(e)},a.moreHandle=function(e,t){"handleModalVisible"===e?a.handleModalVisible(t,!0,0):"handleDel"===e&&a.handleDel(t,3)},a.renderMoreBtn=function(e){var t=e.current;return F.a.createElement(k["a"],{overlay:F.a.createElement(E["b"],{onClick:function(e){var n=e.key;return a.moreHandle(n,t)}},F.a.createElement(E["b"].Item,{key:"handleModalVisible"},"Modify"),F.a.createElement(E["b"].Item,{key:"handleDel"},"Del"))},F.a.createElement("a",null,"More ",F.a.createElement(v["a"],{type:"down"})))},a.authChange=function(e){a.setState({authType:e})},a}return M()(t,e),A()(t,[{key:"componentDidMount",value:function(){var e=this.props.location,t=e.state,a=t||{id:"",orgCode:""},n=a.id,r=a.orgCode;this.setState({orgId:n,orgCode:r}),""!==r&&""!==n&&this.getOrgDetail(n)}},{key:"render",value:function(){var e=this,t=this.state,a=t.modalVisible,n=t.transferVisible,r=t.drawerVisible,l=t.selectedRow,i=t.orgId,o=t.apiServices,s=t.appkeyInbounds,c=t.appkeyOutbounds,k=t.sign,v=t.authType,E=Object(U["g"])(),C={key:"id",name:"id",columnDetails:[{name:"appkey",title:"App Key",sorter:!0,add:!1,edit:!0,disabledAct:"true"},{name:"callerName",title:"Caller Name",sorter:!0,add:!0,edit:!0},{name:"password",title:"Password",sorter:!0},{name:"newPassword",title:"New Password",sorter:!0,add:!0,edit:!0},{name:"authType",title:"Auth Type of Consumer",columnHidden:!1,add:!0,edit:!0,tag:"commonSelect",tableName:"org",query:!0,enumData:ie},{name:"tokenExpireTime",title:"Token Expire Time",add:!0,edit:!0,rules:[],tag:"commonSelect",enumData:oe},{name:"tokenExpire",title:"Expire Time\uff08Minute\uff09",add:!0,edit:!0,rules:[]},{name:"status",title:"status",tag:"commonSelect",sorter:!0,edit:!0,enumData:le},{name:"remark",title:"Remark",sorter:!0,add:!0,edit:!0}]};1===k&&(C={key:"id",name:"id",columnDetails:[{name:"authRange",title:"Outbound Type",tag:"commonSelect",enumData:se,sorter:!0,add:!0},{name:"appkey",title:"App Key",sorter:!0,add:!0,edit:!0},{name:"authType",title:"Auth Type of Consumer",tag:"commonSelect",enumData:ie,add:!0,edit:!0,rules:[]},{name:"targetSystemName",title:"Target System Name",sorter:!0,add:!0,edit:!0},{name:"password",title:"Password",rules:[],edit:!0},{name:"newPassword",title:"New Password",sorter:!0,add:!0},{name:"tokenExpireTime",title:"Token Expire Time",add:!0,edit:!0,rules:[]},{name:"authCount",title:"Auth Count",add:!0,edit:!0,rules:[]},{name:"status",title:"status",tag:"commonSelect",sorter:!0,enumData:le,edit:!0},{name:"remark",title:"Remark",sorter:!0}]});var S=[{title:"Appkey",dataIndex:"appkey",render:function(t,a){return F.a.createElement("a",{onClick:function(){return e.handleDrawerVisible(a,!0)}},t)}},{title:"Caller Name",dataIndex:"callerName"},{title:"Auth Secret",dataIndex:"authSecret",render:function(e){return F.a.createElement(B["a"],{length:20,tooltip:!0},e)}},{title:"Auth Ratio",dataIndex:"authRatio"},{name:"action",title:"Action",render:function(t,a){return F.a.createElement(H["Fragment"],null,F.a.createElement("span",null,F.a.createElement("a",{onClick:function(){return e.handleAccess(!0,a)}},"Access")),F.a.createElement(b["a"],{type:"vertical"}),e.renderMoreBtn({current:a}))}}],w=[{title:"appkey",dataIndex:"appkey",width:50,render:function(t,a){return F.a.createElement("a",{onClick:function(){return e.handleDrawerVisible(a,!0)}},t)}},{title:"Target System Name",dataIndex:"targetSystemName",render:function(e,t){var a=t.newPassword;return a?F.a.createElement("span",null,e):F.a.createElement(g["a"],{color:"#87d068"},e)}},{title:"Auth Count",dataIndex:"authCount"},{title:"Outbound Type",dataIndex:"authRange",filters:de,render:function(e){return F.a.createElement("span",null,Object(X["c"])(se,e))}},{name:"action",title:"Action",render:function(t,a){return F.a.createElement("span",null,F.a.createElement("a",{onClick:function(){return e.handleModalVisible(a,!0,1)}},"Modify"),F.a.createElement(b["a"],{type:"vertical"}),F.a.createElement("a",{onClick:function(){return e.handleDel(a,3)}},"Del"))}}],V=F.a.createElement(f["a"],{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(null,!0,0)}},"New"),A=F.a.createElement(f["a"],{icon:"plus",type:"danger",onClick:function(){return e.handleModalVisible(null,!0,1)}},"Import"),I={handleAdd:this.handleAdd,handleModalVisible:this.handleModalVisible},D={pageSize:5};return F.a.createElement(Y["a"],null,F.a.createElement(m["a"],{bordered:!1},F.a.createElement(h["a"],{gutter:2},F.a.createElement(y["a"],{lg:6,md:12,sm:24},F.a.createElement("span",null,"Org Name"),F.a.createElement(W["a"],{style:{width:"100%"},userId:E,onChange:this.getOrgInfo,value:i})))),F.a.createElement(h["a"],{gutter:16},F.a.createElement(y["a"],{span:12},F.a.createElement(m["a"],{title:"Inbound System AppKey",bordered:!1,extra:V},F.a.createElement(p["a"],{columns:S,dataSource:s,size:"small",bordered:"true",pagination:D}))),F.a.createElement(y["a"],{span:12},F.a.createElement(m["a"],{title:"Outbound System AppKey",bordered:!1,extra:A},F.a.createElement(p["a"],{columns:w,dataSource:c,size:"small",bordered:"true",pagination:D})))),F.a.createElement(ue,u()({},I,{modalVisible:a,selectedRow:l,renderAutoForm:!0,columnSchemas:C,authChange:this.authChange,authType:v})),F.a.createElement(d["a"],{height:400,placement:"bottom",closable:!0,onClose:this.onDrawerClose,visible:r},F.a.createElement(Q,{selectedRow:l,targetServices:o})),F.a.createElement(ae,{title:"Access Api",modalVisible:n,onVisible:this.handleTransferVisible,selectedRow:l,onRefreshData:this.handleRefreshData,keyName:"apiId",apiServices:o,relationName:"apiServices"}))}}]),t}(H["PureComponent"]),o=s))||o);t["default"]=pe}}]);