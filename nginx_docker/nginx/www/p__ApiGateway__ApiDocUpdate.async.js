(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{lDE1:function(e,a,t){"use strict";t.r(a);t("j+Ep");var r,n,o,c,i=t("/Dxd"),l=(t("ssvk"),t("Qo4C")),s=(t("cZcT"),t("T+5x")),p=(t("4WAF"),t("Qfhr")),m=(t("KbV2"),t("I+kI")),d=(t("mofY"),t("HZOl")),u=(t("85xf"),t("IYgN")),y=(t("Z3A/"),t("pB2J")),f=t("3CjV"),S=t.n(f),h=t("mK77"),b=t.n(h),v=t("43Yg"),E=t.n(v),k=t("/tCh"),g=t.n(k),C=t("scpF"),w=t.n(C),B=t("O/V9"),q=t.n(B),x=t("8aBX"),I=t.n(x),O=(t("YyIT"),t("2pDd")),T=(t("PCp+"),t("HnZV")),D=(t("GCRk"),t("fmtF")),N=t("uqIC"),j=t.n(N),A=t("7xWr"),V=t.n(A),P=t("LneV"),R=t("WnAZ"),F=t("zHco"),H=t("0EJC"),G=t("gcl2"),M=t.n(G),U=t("nPZ7"),z=t("814e"),J=t("DnsZ"),L=(J["a"].CALL_POINT,D["a"].TabPane),Z=T["a"].TextArea,K="requestHeader",W="requestBody",Y="responseBody",Q="responseHeader",X="stateCode",_="busiCode",$={requestBodySample:"request Body Sample",responseBodySample:"response Body Sample"},ee=(r=Object(P["connect"])(function(e){var a=e.apiCreateModel,t=e.loading;return{apiService:a.apiService,submitting:t.effects["apiCreateModel/submitStepForm"]}}),n=O["a"].create(),r(o=n((c=function(e){function a(){var e,t;E()(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t=w()(this,(e=q()(a)).call.apply(e,[this].concat(n))),t.state={width:"100%",apiServiceDoc:{},urlSpec:[],requestHeaderSpec:[],requestBodySpec:[],responseHeaderSpec:[],responseBodySpec:[],stateCodeSpec:[],busiCodeSpec:[]},t.getApi=function(e){var a=t.props.dispatch;if(-1!==e){var r={option:4,range:1,data:{}};r.data.info={},r.data.info.apiId=e,a({type:"apiCreateModel/apiInfo",payload:r,callback:function(e){t.setBaseInfo(e,a)}})}else V.a.push("/exception/403")},t.convertDocObj=function(e,a){try{if(e){var t=e["".concat(a,"Spec")];if(t&&""!==t.trim()){var r=(JSON.parse(t)||[]).map(function(e,a){return b()({},e,{key:"".concat(K,"-").concat(a)})});return r}}}catch(e){}return[]},t.setBaseInfo=function(e){var a=e.data,r=a&&a.apiServiceDoc?a.apiServiceDoc:{urlSpec:"[]"},n=t.convertDocObj(r,K),o=t.convertDocObj(r,W),c=t.convertDocObj(r,Q),i=t.convertDocObj(r,Y),l=t.convertDocObj(r,X),s=t.convertDocObj(r,_),p=(JSON.parse(r.urlSpec)||[]).map(function(e,a){return b()({},e,{key:"url-".concat(a)})}),m=0===p.length?t.handleUrlGenerate(p,!1):p;void 0===r.apiServiceDocId&&(n.push({key:"".concat(K,"-0"),parent:"-",name:"AppKey",type:"string",remark:"A unique app key of the caller accessing Api Gateway"}),n.push({key:"".concat(K,"-1"),parent:"-",name:"Authorization",type:"string",remark:"Set a token, if must use token authentication"})),t.setState({apiServiceDoc:r,urlSpec:m,requestHeaderSpec:n,requestBodySpec:o,responseHeaderSpec:c,responseBodySpec:i,stateCodeSpec:l,busiCodeSpec:s})},t.handleUrlGenerate=function(e,a){var r=t.props.apiService,n=r.requestUrl,o=n;if(a){var c=t.props.form,i=c.getFieldsValue(),l=i.urlSample;o=l}var s=[];if(o&&""!==o.trim()&&o.indexOf("{")>-1){var p=Object(z["i"])(o);s=p.map(function(a){var t=e.find(function(e){return e.name===a.name&&e.parent===a.parent});return t?b()({},a,{remark:t.remark}):a})}if(o&&""!==o.trim()&&o.indexOf("?")>-1){var m=Object(z["j"])(o),d=m.map(function(e){var a=s.find(function(a){return a.name===e.name&&a.parent===e.parent});return a?b()({},e,{remark:a.remark}):e});s=s.concat(d)}return s=s.map(function(e,a){return b()({},e,{key:"url-".concat(a)})}),a&&t.setState({urlSpec:s}),s},t.handleBodyGenerate=function(e){var a=t.props.form,r=a.getFieldsValue(),n=r["".concat(e,"Sample")],o=r["".concat(e,"Spec")];if(n&&""!==n.trim()){var c=Object(z["k"])(n);if(c.result){var i=JSON.parse(n),l=[{name:"root",type:Object(z["m"])(i),remark:"root element",parent:"-"}],s="array"===Object(z["m"])(i)?i[0]:i;Object(z["l"])(s,l,"root");var p=l.map(function(e){var a=o.find(function(a){return a.name===e.name&&a.parent===e.parent});return a?b()({},e,{remark:a.remark}):e}),m=p.map(function(a,t){return b()({},a,{key:"".concat(e,"-").concat(t)})});a.setFieldsValue(S()({},"".concat(e,"Spec"),m)),t.setState(S()({},"".concat(e,"Spec"),m))}else y["a"].error(c.msg)}},t.resizeFooterToolbar=function(){requestAnimationFrame(function(){var e=document.querySelectorAll(".ant-layout-sider")[0];if(e){var a="calc(100% - ".concat(e.style.width,")"),r=t.state.width;r!==a&&t.setState({width:a})}})},t.getErrorInfo=function(){var e=t.props.form.getFieldsError,a=e(),r=Object.keys(a).filter(function(e){return a[e]}).length;if(!a||0===r)return null;var n=function(e){var a=document.querySelector('label[for="'.concat(e,'"]'));a&&a.scrollIntoView(!0)},o=Object.keys(a).map(function(e){return a[e]?j.a.createElement("li",{key:e,className:M.a.errorListItem,onClick:function(){return n(e)}},j.a.createElement(u["a"],{type:"cross-circle-o",className:M.a.errorIcon}),j.a.createElement("div",{className:M.a.errorMessage},a[e][0]),j.a.createElement("div",{className:M.a.errorField},$[e])):null});return j.a.createElement("span",{className:M.a.errorIcon},j.a.createElement(d["a"],{title:"\u8868\u5355\u6821\u9a8c\u4fe1\u606f",content:o,overlayClassName:M.a.errorPopover,trigger:"click",getPopupContainer:function(e){return e.parentNode}},j.a.createElement(u["a"],{type:"exclamation-circle"})),r)},t.validate=function(){var e=t.props,a=e.form.validateFieldsAndScroll,r=e.apiService,n=e.dispatch;a(function(e,a){if(!e){var o=Object(U["f"])(r,a);n({type:"apiCreateModel/submitApiDoc",payload:o,callback:function(){t.getApi(r.apiId),y["a"].success("Submit finished!",10)}})}})},t}return I()(a,e),g()(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resizeFooterToolbar,{passive:!0});var e=this.props.location,a=e.state,t=a||{apiId:0},r=t.apiId;this.getApi(r)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeFooterToolbar)}},{key:"render",value:function(){var e=this,a=this.props,t=a.form.getFieldDecorator,r=a.submitting,n=a.apiService,o=j.a.createElement("span",{style:{marginLeft:"60px"}},"\xa0\xa0\xa0\xa0\xa0\xa0\xa0Please click Submit For save Api Doc"),c=j.a.createElement(m["a"],{type:"primary",block:!0,onClick:this.validate,loading:r},"Submit"),d=this.state,u=d.width,y=d.apiServiceDoc,f=d.urlSpec,S=d.requestBodySpec,h=d.requestHeaderSpec,b=d.responseHeaderSpec,v=d.responseBodySpec,E=d.stateCodeSpec,k=d.busiCodeSpec,g='sample for post:{"type":"xxx","name":"xxx"}';return j.a.createElement(F["a"],{onBack:function(){return window.history.back()},style:{height:"50px"},title:"Compile Api Specification"},j.a.createElement(D["a"],{defaultActiveKey:"1",tabBarExtraContent:c},j.a.createElement(L,{tab:"Url",key:"1"},j.a.createElement(l["a"],{title:"",className:M.a.card,bordered:!1},j.a.createElement(s["a"],{gutter:2},j.a.createElement(p["a"],{xl:{span:6},lg:{span:6},md:{span:12},sm:24,style:{height:50}},j.a.createElement(O["a"].Item,{label:"Request Method",labelCol:{span:12},wrapperCol:{span:12}},t("reqMethod",{initialValue:n.reqMethod,rules:[]})(j.a.createElement(T["a"],{placeholder:"request Method",disabled:!0})))),j.a.createElement(p["a"],{lg:18,md:12,sm:24,style:{height:50}},j.a.createElement(O["a"].Item,{label:"Request Path",labelCol:{span:4},wrapperCol:{span:20}},t("urlSample",{initialValue:y.urlSample&&""!==y.urlSample.trim()?y.urlSample:n.requestUrl,rules:[{required:!1,message:"urlSample must be between 2 and 500 characters\uff01",min:2,max:500}]})(j.a.createElement(T["a"],{placeholder:"request Url"}))))),j.a.createElement(m["a"],{style:{width:"100%",marginTop:8,marginBottom:8},type:"dashed",icon:"arrow-down",htmlType:"button",onClick:function(){return e.handleUrlGenerate(f,!0)}},"Generate Specification By Url"),j.a.createElement(O["a"].Item,{label:"Url PlaceHolders Specification"},t("urlSpec",{initialValue:f})(j.a.createElement(H["a"],{hideParent:!0}))))),j.a.createElement(L,{tab:"Request Header",key:"2"},j.a.createElement(l["a"],{title:"",className:M.a.card,bordered:!1},t("requestHeaderSpec",{initialValue:h})(j.a.createElement(H["a"],{hideParent:!0,hideType:!0,nameTitle:"Key",remarkTitle:"Remark"})))),j.a.createElement(L,{tab:"Request Body",key:"3"},j.a.createElement(l["a"],{title:"Request Parameter Body Sample",className:M.a.card,bordered:!1},j.a.createElement(O["a"].Item,null,t("".concat(W,"Sample"),{initialValue:y.requestBodySample,rules:[{required:!1,message:"\u4e0d\u80fd\u8d85\u8fc75000\u5b57\u7b26\uff01",max:5e3}]})(j.a.createElement(Z,{placeholder:g,autosize:{minRows:4,maxRows:15}}))),j.a.createElement(m["a"],{style:{width:"100%",marginTop:16,marginBottom:8},type:"dashed",icon:"arrow-down",htmlType:"button",onClick:function(){return e.handleBodyGenerate(W)}},"Generate Specification By Sample")),j.a.createElement(l["a"],{title:"Request Parameter Body Specification",className:M.a.card,bordered:!1},t("requestBodySpec",{initialValue:S})(j.a.createElement(H["a"],null)))),j.a.createElement(L,{tab:"Response Header",key:"4"},j.a.createElement(l["a"],{title:"",className:M.a.card,bordered:!1},t("responseHeaderSpec",{initialValue:b})(j.a.createElement(H["a"],{hideParent:!0,hideType:!0,nameTitle:"Key",remarkTitle:"Remark"})))),j.a.createElement(L,{tab:"Response Body",key:"5"},j.a.createElement(l["a"],{title:"Response Parameter Body Sample",className:M.a.card,bordered:!1},j.a.createElement(O["a"].Item,null,t("".concat(Y,"Sample"),{initialValue:y.responseBodySample,rules:[{required:!1,message:"\u4e0d\u80fd\u8d85\u8fc75000\u5b57\u7b26\uff01",max:5e3}]})(j.a.createElement(Z,{rows:4,placeholder:g,autosize:{minRows:4,maxRows:15}}))),j.a.createElement(m["a"],{style:{width:"100%",marginTop:16,marginBottom:8},type:"dashed",icon:"arrow-down",htmlType:"button",onClick:function(){return e.handleBodyGenerate(Y)}},"Generate Specification By Sample")),j.a.createElement(l["a"],{title:"Response Parameter Body Specification",className:M.a.card,bordered:!1},t("responseBodySpec",{initialValue:v})(j.a.createElement(H["a"],null)))),j.a.createElement(L,{tab:"Response Code",key:"6"},j.a.createElement(l["a"],{title:"State Code",className:M.a.card,bordered:!1},t("stateCodeSpec",{initialValue:E})(j.a.createElement(H["a"],{hideParent:!0,hideType:!0,nameTitle:"Code"}))),j.a.createElement(l["a"],{title:"Business Code",className:M.a.card,bordered:!1},t("busiCodeSpec",{initialValue:k})(j.a.createElement(H["a"],{hideParent:!0,hideType:!0,nameTitle:"Code"}))))),j.a.createElement(i["a"],null),j.a.createElement(R["a"],{style:{width:u},extra:o},this.getErrorInfo(),c))}}]),a}(N["PureComponent"]),o=c))||o)||o);a["default"]=ee}}]);